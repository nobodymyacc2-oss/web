<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Random Chat – Omegle Style</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Socket.IO client via CDN -->
    <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>
  </head>
  <body class="bg-slate-900 text-slate-100 min-h-screen flex items-center justify-center">
    <div class="w-full max-w-2xl mx-4">
      <div class="bg-slate-800 rounded-2xl shadow-xl border border-slate-700 overflow-hidden">
        <!-- Header -->
        <div class="px-6 py-4 border-b border-slate-700 flex items-center justify-between">
          <div>
            <h1 class="text-xl font-bold">Random Stranger Chat</h1>
            <p class="text-xs text-slate-400">
              Anonymous 1-to-1 chat – no login, no profile, just text.
            </p>
          </div>
          <span class="inline-flex items-center rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-medium text-emerald-300">
            ● Online
          </span>
        </div>

        <!-- Status -->
        <div id="statusBox" class="px-6 py-2 text-xs text-slate-400">
          Click “Start” to find a stranger.
        </div>

        <!-- Chat area -->
        <div class="px-6 pt-2 pb-4">
          <div
            id="chatBox"
            class="h-80 overflow-y-auto rounded-xl bg-slate-900/70 border border-slate-700 p-3 space-y-2 text-sm"
          >
            <!-- Messages will appear here -->
          </div>

          <!-- Input -->
          <form id="messageForm" class="mt-3 flex gap-2">
            <input
              id="messageInput"
              type="text"
              placeholder="Type a message..."
              class="flex-1 rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-sm outline-none focus:border-indigo-500"
              autocomplete="off"
            />
            <button
              type="submit"
              class="rounded-xl bg-indigo-500 px-4 py-2 text-sm font-semibold hover:bg-indigo-600 active:bg-indigo-700 disabled:opacity-40"
            >
              Send
            </button>
          </form>

          <!-- Controls -->
          <div class="mt-3 flex flex-wrap gap-2">
            <button
              id="startBtn"
              class="flex-1 rounded-xl bg-emerald-500 px-4 py-2 text-sm font-semibold hover:bg-emerald-600 active:bg-emerald-700"
            >
              Start / Connect
            </button>
            <button
              id="nextBtn"
              class="rounded-xl bg-amber-500 px-4 py-2 text-sm font-semibold hover:bg-amber-600 active:bg-amber-700"
            >
              Next
            </button>
            <button
              id="disconnectBtn"
              class="rounded-xl bg-rose-500 px-4 py-2 text-sm font-semibold hover:bg-rose-600 active:bg-rose-700"
            >
              Disconnect
            </button>
          </div>

          <p class="mt-2 text-[10px] text-slate-500">
            Demo clone for learning purposes. Do not share personal data.
          </p>
        </div>
      </div>
    </div>

    <script>
      // Connect to Socket.IO server on same origin (localhost:3000)
      const socket = io(); // will connect to the server that serves this HTML

      const chatBox = document.getElementById("chatBox");
      const statusBox = document.getElementById("statusBox");
      const messageForm = document.getElementById("messageForm");
      const messageInput = document.getElementById("messageInput");
      const startBtn = document.getElementById("startBtn");
      const nextBtn = document.getElementById("nextBtn");
      const disconnectBtn = document.getElementById("disconnectBtn");

      function addSystemMessage(text) {
        const div = document.createElement("div");
        div.className = "text-xs text-slate-400 text-center";
        div.textContent = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function addMessage(from, text) {
        const wrapper = document.createElement("div");
        const isYou = from === "you";

        wrapper.className =
          "flex " + (isYou ? "justify-end" : "justify-start");

        const bubble = document.createElement("div");
        bubble.className =
          "max-w-[80%] px-3 py-2 rounded-2xl text-xs sm:text-sm " +
          (isYou
            ? "bg-indigo-500 text-white rounded-br-none"
            : "bg-slate-700 text-slate-50 rounded-bl-none");

        const label = document.createElement("div");
        label.className =
          "text-[10px] uppercase tracking-wide mb-0.5 " +
          (isYou ? "text-indigo-200" : "text-slate-300");
        label.textContent = isYou ? "You" : "Stranger";

        const body = document.createElement("div");
        body.textContent = text;

        bubble.appendChild(label);
        bubble.appendChild(body);
        wrapper.appendChild(bubble);

        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Socket events
      socket.on("status", (data) => {
        statusBox.textContent = data.message;
        addSystemMessage(data.message);
      });

      socket.on("paired", (data) => {
        statusBox.textContent = data.message;
        addSystemMessage("You are now chatting with a stranger.");
      });

      socket.on("serverMessage", (data) => {
        addMessage(data.from, data.text);
      });

      socket.on("partnerDisconnected", (data) => {
        addSystemMessage(data.message || "Stranger disconnected.");
        statusBox.textContent = "Stranger disconnected. Click Start or Next.";
      });

      // UI events
      startBtn.addEventListener("click", () => {
        socket.emit("findPartner");
      });

      nextBtn.addEventListener("click", () => {
        addSystemMessage("Searching for next stranger...");
        socket.emit("nextPartner");
      });

      disconnectBtn.addEventListener("click", () => {
        socket.emit("disconnectPartner");
        addSystemMessage("You left the chat.");
        statusBox.textContent = "Disconnected. Click Start to find a new stranger.";
      });

      messageForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const text = messageInput.value.trim();
        if (!text) return;

        socket.emit("clientMessage", { text });
        messageInput.value = "";
      });
    </script>
  </body>
</html>
