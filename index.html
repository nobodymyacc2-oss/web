<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Random Chat – Connect with Strangers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Socket.IO client via CDN -->
    <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>
  </head>
  <body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center">
    <div class="w-full max-w-5xl mx-4">
      <div
        class="bg-gradient-to-br from-slate-900/90 via-slate-900 to-slate-950 rounded-3xl shadow-2xl border border-slate-800/70 overflow-hidden grid grid-cols-1 lg:grid-cols-[260px,1fr]"
      >
        <!-- LEFT SIDEBAR: branding + profile -->
        <aside class="bg-slate-950/60 border-r border-slate-800/70 p-6 space-y-6">
          <div>
            <div class="inline-flex items-center gap-2 rounded-full bg-slate-900/80 px-3 py-1 border border-slate-700 mb-3">
              <span class="h-2 w-2 rounded-full bg-emerald-400 animate-pulse"></span>
              <span class="text-[11px] font-medium text-slate-300">Live random chat</span>
            </div>
            <h1 class="text-2xl font-semibold tracking-tight">
              RandomChat<span class="text-indigo-400">.live</span>
            </h1>
            <p class="mt-2 text-xs text-slate-400">
              Start a private 1-to-1 text conversation with a random stranger.
              No account required. Please respect others and keep it safe.
            </p>
          </div>

          <!-- Profile form -->
          <div class="space-y-3 text-sm">
            <h2 class="text-xs font-semibold tracking-wide text-slate-400 uppercase">
              Your basic info
            </h2>

            <div class="space-y-2">
              <div>
                <label class="block text-xs text-slate-400 mb-1">Age</label>
                <input
                  id="ageInput"
                  type="number"
                  min="13"
                  max="120"
                  placeholder="21"
                  class="w-full rounded-xl bg-slate-950 border border-slate-700 px-3 py-2 text-xs outline-none focus:border-indigo-500"
                />
              </div>

              <div>
                <label class="block text-xs text-slate-400 mb-1">Gender</label>
                <select
                  id="genderSelect"
                  class="w-full rounded-xl bg-slate-950 border border-slate-700 px-3 py-2 text-xs outline-none focus:border-indigo-500"
                >
                  <option value="">Select...</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                  <option value="Prefer not to say">Prefer not to say</option>
                </select>
              </div>

              <div>
                <label class="block text-xs text-slate-400 mb-1">Country</label>
                <input
                  id="countryInput"
                  type="text"
                  placeholder="Germany"
                  class="w-full rounded-xl bg-slate-950 border border-slate-700 px-3 py-2 text-xs outline-none focus:border-indigo-500"
                />
              </div>
            </div>

            <p id="profileHint" class="text-[11px] text-slate-500">
              This information is shown to your chat partner. Don’t share your real
              name, phone, or other sensitive data.
            </p>
          </div>

          <!-- Your profile summary -->
          <div class="mt-4 border-t border-slate-800 pt-4">
            <h3 class="text-xs font-semibold text-slate-400 uppercase mb-2">
              Your status
            </h3>
            <div class="text-[11px] space-y-1 text-slate-300" id="yourProfileSummary">
              <p>Age: <span class="text-slate-400">–</span></p>
              <p>Gender: <span class="text-slate-400">–</span></p>
              <p>Country: <span class="text-slate-400">–</span></p>
            </div>
          </div>
        </aside>

        <!-- MAIN: chat -->
        <main class="p-6 lg:p-8 flex flex-col">
          <!-- Top bar -->
          <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mb-4">
            <div class="flex-1">
              <p id="statusBox" class="text-xs text-slate-400">
                Fill in your info and click <span class="font-semibold text-slate-200">Start</span> to
                find a stranger.
              </p>
              <p id="partnerInfo" class="text-[11px] text-slate-500 mt-1">
                Not connected.
              </p>
            </div>
            <div class="flex gap-2">
              <button
                id="startBtn"
                class="rounded-xl bg-emerald-500 px-4 py-2 text-xs sm:text-sm font-semibold hover:bg-emerald-600 active:bg-emerald-700"
              >
                Start
              </button>
              <button
                id="nextBtn"
                class="rounded-xl bg-amber-500 px-4 py-2 text-xs sm:text-sm font-semibold hover:bg-amber-600 active:bg-amber-700"
              >
                Next
              </button>
              <button
                id="disconnectBtn"
                class="rounded-xl bg-rose-500 px-4 py-2 text-xs sm:text-sm font-semibold hover:bg-rose-600 active:bg-rose-700"
              >
                Disconnect
              </button>
            </div>
          </div>

          <!-- Chat box -->
          <div
            id="chatBox"
            class="flex-1 min-h-[260px] max-h-[460px] overflow-y-auto rounded-2xl bg-slate-950/60 border border-slate-800 p-4 space-y-2 text-sm"
          >
            <!-- Messages appear here -->
          </div>

          <!-- Message form -->
          <form id="messageForm" class="mt-4 flex gap-2">
            <input
              id="messageInput"
              type="text"
              placeholder="Type a message…"
              class="flex-1 rounded-2xl bg-slate-950 border border-slate-800 px-3 py-2 text-sm outline-none focus:border-indigo-500 disabled:opacity-50"
              autocomplete="off"
            />
            <button
              type="submit"
              class="rounded-2xl bg-indigo-500 px-4 py-2 text-sm font-semibold hover:bg-indigo-600 active:bg-indigo-700 disabled:opacity-40"
            >
              Send
            </button>
          </form>

          <p class="mt-3 text-[10px] text-slate-500">
            This is a demo project for educational use. Conversations are not monitored.
            Never share passwords, phone numbers, or private information.
          </p>
        </main>
      </div>
    </div>

    <script>
      const socket = io(); // connects to same origin (server.js)

      // DOM elements
      const chatBox = document.getElementById("chatBox");
      const statusBox = document.getElementById("statusBox");
      const partnerInfo = document.getElementById("partnerInfo");
      const messageForm = document.getElementById("messageForm");
      const messageInput = document.getElementById("messageInput");
      const startBtn = document.getElementById("startBtn");
      const nextBtn = document.getElementById("nextBtn");
      const disconnectBtn = document.getElementById("disconnectBtn");

      const ageInput = document.getElementById("ageInput");
      const genderSelect = document.getElementById("genderSelect");
      const countryInput = document.getElementById("countryInput");
      const yourProfileSummary = document.getElementById("yourProfileSummary");

      function updateYourProfileSummary(profile) {
        const { age, gender, country } = profile;
        yourProfileSummary.innerHTML = `
          <p>Age: <span class="text-slate-200">${age || "–"}</span></p>
          <p>Gender: <span class="text-slate-200">${gender || "–"}</span></p>
          <p>Country: <span class="text-slate-200">${country || "–"}</span></p>
        `;
      }

      function addSystemMessage(text) {
        const div = document.createElement("div");
        div.className = "text-[11px] text-slate-400 text-center";
        div.textContent = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function addMessage(from, text) {
        const wrapper = document.createElement("div");
        const isYou = from === "you";

        wrapper.className = "flex " + (isYou ? "justify-end" : "justify-start");

        const bubble = document.createElement("div");
        bubble.className =
          "max-w-[80%] px-3 py-2 rounded-2xl text-xs sm:text-sm " +
          (isYou
            ? "bg-indigo-500 text-white rounded-br-none"
            : "bg-slate-800 text-slate-50 rounded-bl-none");

        const label = document.createElement("div");
        label.className =
          "text-[10px] uppercase tracking-wide mb-0.5 " +
          (isYou ? "text-indigo-200" : "text-slate-300");
        label.textContent = isYou ? "You" : "Stranger";

        const body = document.createElement("div");
        body.textContent = text;

        bubble.appendChild(label);
        bubble.appendChild(body);
        wrapper.appendChild(bubble);

        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function validateProfile() {
        const age = ageInput.value.trim();
        const gender = genderSelect.value;
        const country = countryInput.value.trim();

        if (!age || !gender || !country) {
          statusBox.textContent = "Please fill age, gender and country before starting.";
          statusBox.classList.add("text-rose-400");
          return null;
        }

        statusBox.classList.remove("text-rose-400");

        const profile = { age, gender, country };
        updateYourProfileSummary(profile);
        return profile;
      }

      // Socket events
      socket.on("status", (data) => {
        statusBox.textContent = data.message;
        partnerInfo.textContent = "Not connected.";
        addSystemMessage(data.message);
      });

      socket.on("paired", (data) => {
        statusBox.textContent = data.message;
        const p = data.partnerProfile || {};
        partnerInfo.textContent =
          "Connected to stranger" +
          (p.age || p.gender || p.country
            ? ` — Age: ${p.age || "?"}, Gender: ${p.gender || "?"}, Country: ${
                p.country || "?"
              }`
            : "");
        addSystemMessage("You are now chatting with a stranger.");
      });

      socket.on("serverMessage", (data) => {
        addMessage(data.from, data.text);
      });

      socket.on("partnerDisconnected", (data) => {
        addSystemMessage(data.message || "Stranger disconnected.");
        partnerInfo.textContent = "Not connected.";
        statusBox.textContent = "Stranger disconnected. Click Start or Next.";
      });

      // UI events
      startBtn.addEventListener("click", () => {
        const profile = validateProfile();
        if (!profile) return;
        socket.emit("setProfile", profile);
        socket.emit("findPartner");
        addSystemMessage("Searching for a stranger…");
      });

      nextBtn.addEventListener("click", () => {
        const profile = validateProfile();
        if (!profile) return;
        socket.emit("setProfile", profile);
        addSystemMessage("Searching for next stranger…");
        socket.emit("nextPartner");
      });

      disconnectBtn.addEventListener("click", () => {
        socket.emit("disconnectPartner");
        addSystemMessage("You left the chat.");
        partnerInfo.textContent = "Not connected.";
        statusBox.textContent = "Disconnected. Click Start to find a new stranger.";
      });

      messageForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const text = messageInput.value.trim();
        if (!text) return;

        socket.emit("clientMessage", { text });
        messageInput.value = "";
      });
    </script>
  </body>
</html>
